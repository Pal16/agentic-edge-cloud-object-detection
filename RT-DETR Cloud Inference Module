"""Transformer-based detector for complex scenes.
"""
import time
from ultralytics import YOLO


class RTDETRCloudDetector:
    def __init__(self, model_name: str = "rtdetr-l.pt", network_delay: float = 0.05):
        self.model = YOLO(model_name)
        self.network_delay = network_delay

    def infer(self, image_path: str):
        start = time.time()
        result = self.model(image_path, verbose=False)[0]
        latency = time.time() - start + self.network_delay

        detections = []
        if result.boxes is not None:
            for box, conf, cls in zip(
                result.boxes.xyxy,
                result.boxes.conf,
                result.boxes.cls
            ):
                x1, y1, x2, y2 = box.tolist()
                detections.append({
                    "bbox": [x1, y1, x2 - x1, y2 - y1],
                    "score": float(conf),
                    "category_id": int(cls) + 1
                })

        return detections, latency
